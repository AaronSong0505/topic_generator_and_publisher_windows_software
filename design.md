全自动小红书文案生成与发布设计方案

---

## 0. 当前进度与已完成功能

### 已完成
- 前后端分离架构已落地，整体项目结构已搭建。
- 前端：
  - 基于PyQt5开发，界面已实现中式古风美化（水墨背景、米色底色、古风图标、楷体字体）。
  - 实现了"模拟器控制"功能区，支持一键启动/关闭安卓模拟器，并实时显示模拟器状态。
  - 错误弹窗支持一键复制详细内容。
- 后端：
  - 新增android-emulator服务，基于FastAPI实现，支持MuMu模拟器的启动、关闭、状态查询API。
  - 支持跨域，便于前端本地开发。
  - 已适配MuMu Player 12的实际安装路径和主程序名。
- 自动化环境：
  - 前端和后端依赖均可通过requirements.txt一键安装。
  - 虚拟环境隔离，避免污染全局环境。

### 运行效果
- 前端点击"启动安卓模拟器"可自动启动MuMu模拟器，点击"关闭"可自动关闭。
- 前端每3秒自动轮询后端API，实时刷新模拟器状态。
- 所有界面均为古风美化，用户体验良好。

---

## 一、整体架构梳理

你的项目已经实现了"前后端分离+多Agent模块化"的设计思路，建议继续保持这种结构，具体如下：

```
/
├── Back-end Service/
│   ├── llm-agent/                # 文案与提示词生成
│   ├── image-generator-agent/    # 图片生成
│   ├── publisher-agent/          # 自动化发布
│   ├── state-management-agent/   # 流程与状态管理
│   └── android-emulator/         # 安卓模拟器控制（已实现MuMu控制API）
├── Front-end Client/             # Windows前端
├── Env-auto-install/             # 自动化环境安装
├── requirements.txt              # 统一依赖管理
```

---

## 二、各模块设计建议

### 1. Back-end Service

- 每个Agent建议都实现为独立的FastAPI子应用，便于解耦和后续独立部署/扩展。
- 主服务负责API聚合、任务调度、日志与状态管理。
- 各Agent之间通过内部API或消息队列（如Redis、RabbitMQ）通信，提升并发与解耦能力。

#### 1.1 llm-agent
- 负责与大模型API对接或者直接通过http访问LLM网页，生成小红书文案和图片生成提示词。
  - 打开豆包网页
  - 确定用户是否登录
  - 找到输入框
  - 找到输入框上的“深度思考”按钮并且点击
  - 输入用户需求：生成文案（例如“我现在想在小红书上发布一个和XXX相关的内容，帮我以小红书的风格生成文案”）
  - 找到发送按钮并且点击
  - 等待结果返回且通过检查特定元素确定是否结果返回完毕
  - 获取文案结果且保存到本地文件（用于前端界面显示和后续的文案发送逻辑）
  - 找到输入框，确认上面的“深度思考”按钮已经被点击
  - 输入框中输入用户需求：根据你提供的文案和我的需求生成适用于文生图任务的提示词
  - 找到发送按钮并且点击
  - 等待结果返回且通过检查特定元素确定是否结果返回完毕
  - 获取提示词结果且保存到本地文件（用于前端界面显示和后续的文生图任务）
- 提供RESTful接口，接收前端或主服务的请求，返回文案/提示词。

#### 1.2 image-generator-agent
- 负责调用AI图片生成API，根据提示词生成图片。
- 支持多种图片风格、分辨率参数。
- 图片生成后存储于本地或云端，并返回图片URL/路径。

#### 1.3 publisher-agent
- 负责与安卓模拟器（如MuMu、夜神等）交互，通过ADB+Appium/Poco自动化操作小红书App完成发帖。
- 支持任务队列，自动重试与异常处理。
- 可扩展支持多App自动化发布。

#### 1.4 state-management-agent
- 负责任务流编排（如文案→图片→发布），状态追踪与回溯。
- 提供任务流API，供前端查询任务进度、历史记录等。
- 支持任务暂停、重试、终止等操作。

#### 1.5 android-emulator（已实现）
- 提供MuMu模拟器的启动、关闭、状态API。
- 支持路径自定义，适配多种安装环境。

### 2. Front-end Client

- 建议采用PyQt5/PySide2开发，便于与Python后端集成。
- 主要功能：任务配置、进度展示、日志查看、模拟器控制（启动/关闭）、结果展示。
- 通过HTTP API与后端通信。
- 已实现古风美化、模拟器控制、错误弹窗可复制。

### 3. Env-auto-install

- 统一收集所有依赖到根目录`requirements.txt`，并在Env-auto-install目录下编写自动化安装脚本（如install.bat/install.sh）。
- 脚本内容包括：Python依赖安装、安卓模拟器安装、ADB与Appium环境配置等。
- 提供一键检测与修复功能，提升用户体验。

---

## 三、开发流程建议

1. 优先完善各Agent的API接口与核心功能，确保后端服务可用。
2. 前端开发可同步进行，先实现基础的任务配置与进度展示。
3. 完善自动化环境安装脚本，确保新环境可一键部署。
4. 各模块开发完成后，重点测试整体流程的自动化闭环。
5. 持续完善文档，便于后续维护和团队协作。

---

## 四、补充建议

- 每个Agent目录下建议都包含独立的`readme.md`和`requirements.txt`，便于单独开发和测试。
- 主目录下的`requirements.txt`收集所有依赖，供一键安装。
- 日志与异常处理建议统一规范，便于排查问题。
- 可考虑引入Docker进行环境隔离和部署（后续可选）。

